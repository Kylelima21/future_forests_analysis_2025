---
title: "FFCM_2025_tidy"
output:
  word_document: default
  html_document: default
date: "2025-02-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Steps to Tidy the data

```{r packages, echo=FALSE, warning=FALSE, message=FALSE}
# Loading in packages
#install.packages("readxl")
#install.packages('tidyverse')
#install.packages('dplyr')
#install.packages('writexl')
#install.packages('ggplots')
#install.packages('forcats')
library(readxl)
library(tidyverse)
library(dplyr)
library(writexl)
library(ggplot2)
library(forcats)
```

Step 1: Grab the data
```{r data, echo=FALSE, warning=FALSE, message=FALSE}
belfast <- read_excel("C:\\Users\\jattanasio\\Desktop\\R_related\\FFCM_Data_Belfast_2024.xlsx")
mdi <- read_excel("C:\\Users\\jattanasio\\Desktop\\R_related\\FFCM_Data_MDI_2024.xlsx")
schoodic <- read_excel("C:\\Users\\jattanasio\\Desktop\\R_related\\FFCM_Data_SchoodicNorth_2024.xlsx")
surry <- read_excel("C:\\Users\\jattanasio\\Desktop\\R_related\\FFCM_Data_SurryForest_2024.xlsx")

```
Step 2: Make all the column names the same

Step 3: Make all the Sites have the same number of columns

Step 4: Misc cleaning of columns as I come across errors
```{r belfast, echo=FALSE, warning=FALSE, message=FALSE}
belfast <- belfast %>%
  rename(
    PlantingDate = `Planting Date`,
    Length_summer2019 = `Initial length (cm)_05/24/19`,
    Notes_summer2019 = notes,
    Length_fall2019 = `length_cm 10/19`,
    Notes_fall2019 = `notes 7Oct19`,
    LiveDead_fall2019 = `LiveDead Oct2019`,
    
    LiveDead_summer2020 = `L/D 6/17/20`,
    Browse_summer2020 = `Browse 6/17/20`,
    Length_summer2020 = `Length 6.17.20(cm)`,
    Notes_summer2020 = `Notes 6/17/20`,
    
    LiveDead_summer2021 = `L/D 6/07/21`,
    Browse_summer2021 = `Browse 6/07/21`,
    Length_summer2021 = `Length 6/07/21(cm)`,
    Notes_summer2021 = `Notes 6/07/21`,
    LiveDead_fall2021 = `L/D 10/25/21`,
    Browse_fall2021 = `Browse 10/25/21`,
    Length_fall2021 = `Length 10/25/21 (cm)`,
    Notes_fall2021 = `Notes 10/25/21`,
    
    LiveDead_summer2022 = `L/D 7/7/22`,
    Browse_summer2022 = `Browse Y/N 7/7/22`,
    Length_summer2022 = `Length (cm) 7/7/22`,
    LiveDead_fall2022 = `L/D 10/20/22`,
    Browse_fall2022 = `Browse Y/N 10/20/22`,
    Length_fall2022 = `Length 10/20/22`,
    Notes_fall2022 = `Notes 10/20/22`,
    
    LiveDead_summer2023 = `L/D July 2023`,
    Browse_summer2023 = `Browse Y/N July 2023`,
    Length_summer2023 = `Length July 2023`,
    Notes_summer2023 = `Notes July 2023`,
    LiveDead_fall2023 = `L/D 10/23/23`,
    Length_fall2023 = `Length 10/23/23`,
    Notes_fall2023 = `Notes 10/23/23`,
    
    LiveDead_summer2024 = `L/D 6/13/24`,
    Browse_summer2024 = `Browse Y/N 6/13/24`,
    Length_summer2024 = `Length 6/13/24`,
    Notes_summer2024 = `Notes 6/13/24`,
    LiveDead_fall2024 = `L/D 10/29/24`,
    Browse_fall2024 = `Browse 10/29/24`,
    Length_fall2024 = `Length 10/29/24`,
    Notes_fall2024 = Notes
   ) %>%
  mutate(
    LiveDead_fall2020 = NA,
    Browse_fall2020 = NA, 
    Length_fall2020 = NA,
    Notes_fall2020 = NA, .after = Notes_summer2020
  ) %>%
  mutate( 
    Notes_summer2022 = NA, .after = Length_summer2022
  ) %>%
  mutate(
    Browse_fall2023 = NA, .after = LiveDead_fall2023
  )


```

```{r mdi, echo=FALSE, warning=FALSE, message=FALSE}
mdi <- mdi %>%
  rename(
    PlantingDate = `Planting Date`,
    Tube = `Tube (Y/N)`,
    
    Length_summer2019 = `Initial length (cm)_05/30/19`,
    Notes_summer2019 = notes,
    Length_fall2019 = `length_cm 10/19`,
    Notes_fall2019 = `notes 14Oct19`,
    LiveDead_fall2019 = `LiveDead Oct2019`,
    
    LiveDead_summer2020 = `L/D 6/29/20`,
    Browse_summer2020 = `Browse Y/N 6/29/20`,
    Length_summer2020 = `Length 6/29/20`,
    Notes_summer2020 = `Notes 6/29/20`,
    LiveDead_fall2020 = `L/D 10/01/20`,
    Length_fall2020 = `Length 10/01/20`,
    Notes_fall2020 = `Notes 10/01/20`,
    
    LiveDead_summer2021 = `L/D 6/4/2021`,
    Browse_summer2021 = `Browse 6/4/2021`,
    Length_summer2021 = `Length 6/4/2021`,
    Notes_summer2021 = `Notes 6/4/2021`,
    LiveDead_fall2021 = `L/D 10/15/21`,
    Browse_fall2021 = `Browse Y/N 10/15/21`,
    Length_fall2021 = `Length 10/15/21`,
    Notes_fall2021 = `Notes 10/14/21`,
    
    LiveDead_summer2022 = `L/D 06/21/22`,
    Browse_summer2022 = `Browse Y/N 06/21/22`,
    Length_summer2022 = `Length 06/21/22`,
    Notes_summer2022 = `Notes 06/21/22`,
    LiveDead_fall2022 = `L/D 11/22`,
    Browse_fall2022 = `Browse Y/N 11/22`,
    Length_fall2022 = `Length 11/22`,
    Notes_fall2022 = `Notes 11/22`,
    
    LiveDead_summer2023 = `L/D July 2023`,
    Browse_summer2023 = `Browse Y/N July 2023`,
    Length_summer2023 = `Length July 2023`,
    Notes_summer2023 = `Notes July 2023`,
    LiveDead_fall2023 = `L/D October 12 2023`,
    Browse_fall2023 = `Browse Y/N October 12 2023`,
    Length_fall2023 = `Length October 12 2023`,
    Notes_fall2023 = `Notes October 12 2023`,
    
    LiveDead_summer2024 = `L/D 6/10/24`,
    Browse_summer2024 = `Browse Y/N 6/10/24`,
    Length_summer2024 = `Length 6/10/24`,
    Notes_summer2024 = `Notes 6/10/24`,
    LiveDead_fall2024 = `L/D 10/28/24`,
    Browse_fall2024 = `Browse Y/N 10/28/24`,
    Length_fall2024 = `Length 10/28/24`,
    Notes_fall2024 = `Notes 10/28/24`
  ) %>%
  mutate(
    Browse_fall2020 = NA, .after = LiveDead_fall2020
  )
```
Note: Schoodic Planting Data column doesn't read as a date, fixed.
```{r schoodic, echo=FALSE, warning=FALSE, message=FALSE}
schoodic$`Planting Date` <- as.Date(43617.0, origin = "1899-12-30")

schoodic <- schoodic %>%
  rename(
    PlantingDate = `Planting Date`,
    Tube = `Tube (Y/N)`,
    
    Length_summer2019 = `Initial length (cm)`,
    Notes_summer2019 = notes,
    Length_fall2019 = `length_cm 10/19`,
    Notes_fall2019 = `notes 11Oct19`,
    LiveDead_fall2019 = `LiveDead Oct2019`,
    
    LiveDead_summer2020 = `L/D 6/23/20`,
    Browse_summer2020 = `Browse Y/N 6/23/20`,
    Length_summer2020 = `Length 6/23/20`,
    Notes_summer2020 = `Notes 6/23/20`,
    LiveDead_fall2020 = `LiveDead9/11/20`,
    Length_fall2020 = `Length9/11/20`,
    Notes_fall2020 = `Notes9/11/20`,
    
    LiveDead_summer2021 = `L/D 6/11/21`,
    Browse_summer2021 = `Browse Y/N 6/11/21`,
    Length_summer2021 = `Length 6/11/21`,
    Notes_summer2021 = `Notes 6/11/21`,
    LiveDead_fall2021 = `L/D 10/25/21`,
    Browse_fall2021 = `Browse Y/N 10/25/21`,
    Length_fall2021 = `Length 10/25/21`,
    Notes_fall2021 = `Notes 10/25/21`,
    
    LiveDead_summer2022 = `L/D 06/21/22`,
    Browse_summer2022 = `Browse Y/N 06/21/22`,
    Length_summer2022 = `Length 06/21/22`,
    Notes_summer2022 = `Notes 06/21/22`,
    LiveDead_fall2022 = `L/D 10/20/22`,
    Browse_fall2022 = `Browse Y/N 10/20/22`,
    Length_fall2022 = `Length 10/20/22`,
    Notes_fall2022 = `Notes 10/20/22`,
    
    LiveDead_summer2023 = `LD 6/19/23`,
    Browse_summer2023 = `Browse 6/19/23`,
    Length_summer2023 = `Length 6/19/23`,
    Notes_summer2023 = `Notes 6/19/23`,
    LiveDead_fall2023 = `LD 10/13/23`,
    Length_fall2023 = `Length 10/13/23`,
    Notes_fall2023 = `Notes 10/13/23`,
    
    LiveDead_summer2024 = `L/D 6/6/24`,
    Browse_summer2024 = `Browse 6/6/24`,
    Length_summer2024 = `Length 6/6/24`,
    Notes_summer2024 = `Notes 6/6/24`,
    LiveDead_fall2024 = `L/D 10/28/24`,
    Browse_fall2024 = `Browse 10/28/24`,
    Length_fall2024 = `Length 10/28/24`,
    Notes_fall2024 = `Notes 10/28/24`
  ) %>%
  mutate(
    Browse_fall2020 = NA, .after = LiveDead_fall2020
  ) %>%
  mutate(
    Browse_fall2023 = NA, .after = LiveDead_fall2023
  )
```
Note: Surry had two corrected columns; used the corrected data
```{r surry, echo=FALSE, warning=FALSE, message=FALSE}
surry <- surry %>%
        mutate(`L/D July 2023` = NULL,
         `Length July 2023` = NULL
              ) %>%
        rename(
          PlantingDate = `Planting Date`,
          Tube = `Tube (Y/N)`,
          
          Length_summer2019 = `Initial length (cm)_05/24/19`,
          Notes_summer2019 = `notes`,
          Length_fall2019 = `length_cm 10/19`,
          Notes_fall2019 = `notes 8Oct19`,
          LiveDead_fall2019 = `LiveDead Oct2019`,
          
          LiveDead_summer2020 = `L/D 6/23/20`,
          Browse_summer2020 = `Browse Y/N 6/23/20`,
          Length_summer2020 = `Length 6/23/20`,
          Notes_summer2020 = `Notes 6/23/20`,
          LiveDead_fall2020 = `L/D 9/30/20`,
          Length_fall2020 = `Length 9/30/20`,
          Notes_fall2020 = `Notes 9/30/20`,
          
          LiveDead_summer2021 = `L/D 6/11/21`,
          Browse_summer2021 = `Browse Y/N 6/11/21`,
          Length_summer2021 = `Length 6/11/21`,
          Notes_summer2021 = `Notes 6/11/21`,
          LiveDead_fall2021 = `L/D 10/21`,
          Browse_fall2021 = `Browse Y/N 10/21`,
          Length_fall2021 = `Length 10/21`,
          Notes_fall2021 = `Notes 10/21`,
          
          LiveDead_summer2022 = `L/D 06/22`,
          Browse_summer2022 = `Browse Y/N 06/22`,
          Length_summer2022 = `Length 06/22`,
          Notes_summer2022 = `Notes 06/22`,
          LiveDead_fall2022 = `L/D 11/22`,
          Browse_fall2022 = `Browse Y/N 11/22`,
          Length_fall2022 = `Length 11/22`,
          Notes_fall2022 = `Notes 11/22`,
          
          LiveDead_summer2023 = `corrected L/D July`,
          Length_summer2023 = `corrected Length July`,
          Notes_summer2023 = `Notes July 2023`,
          LiveDead_fall2023 = `L/D October 2023`,
          Browse_fall2023 = `Browse Y/N 10/31/2023 (not collected this season)`,
          Length_fall2023 = `Length Oct 2023`,
          Notes_fall2023 = `Notes Oct 2023`,
          
          LiveDead_summer2024 = `L/D 6/11/24`,
          Browse_summer2024 = `Browse Y/N 6/11/24`,
          Length_summer2024 = `Length 6/11/24`,
          Notes_summer2024 = `Notes 6/11/24`,
          LiveDead_fall2024 = `L/D 10/31/24`,
          Browse_fall2024 = `Browse Y/N 10/31/24`,
          Length_fall2024 = `Length 10/31/24`,
          Notes_fall2024 = `Notes 10/31/24`
        ) %>%
  mutate(
    Browse_fall2020 = NA, .after = LiveDead_fall2020
  ) %>%
  mutate(
    Browse_summer2023 = NA, .after = LiveDead_summer2023
    )

```
Step 5: Combine Sites

Step 6: Add a Unique ID column to keep track of individual seedlings when switching from wide to long

Note: Noticed there is r oak, r. oak, and r.oak. Fixed
```{r, echo=FALSE, warning=FALSE, message=FALSE}
master <- rbind(mdi, schoodic, belfast, surry)
master <- master %>% mutate(UniqueID = 1:n(), .before = Site)
#table(master$Species)
master <- master %>%
  mutate(Species = recode(Species, "r oak" = "r.oak")) %>%
  mutate(Species = recode(Species, "r. oak" = "r.oak"))
```
Note: Noticed that the Tube column is messy. Clean.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
master <- master %>%
  mutate(Tube = recode(Tube, "y" = "Y")) %>%
  mutate(Tube = recode(Tube, "Y." = "Y")) %>%
  mutate(Tube = replace_na(Tube, "N"))
```

Note: The LiveDead and the Browse columns are also very messy, but that was cleaned 
later down the line. Easy to clean Tube Y or N now because it required less effort to clean.

Step 7: Export as an excel file
```{r, echo=FALSE, warning=FALSE, message=FALSE}
write_xlsx(master, 'C:\\Users\\jattanasio\\Desktop\\R_related\\master_combined.xlsx')
```
Note: Numeric woes. Make sure the columns are compatible. Length should be numeric, 
browse should be character....
```{r, echo=FALSE, warning=FALSE, message=FALSE}

#str(master)
master_wide <- master %>%
  mutate_at(c('Length_summer2019', 'Length_fall2019', 'Length_summer2020', 
              'Length_fall2020', 'Length_summer2021', 'Length_fall2021',
              'Length_summer2022', 'Length_fall2022', 'Length_summer2023', 
              'Length_fall2023', 'Length_summer2024', 'Length_fall2024'), as.numeric) %>%
  mutate_at(c('Browse_summer2020', 'Browse_fall2020', 'Browse_summer2021', 'Browse_fall2021',
              'Browse_summer2022', 'Browse_fall2022', 'Browse_summer2023', 
              'Browse_fall2023', 'Browse_summer2024', 'Browse_fall2024'), as.character)

#str(master_wide)

```
Note: Deleting the not planted seedlings
```{r, echo=FALSE, warning=FALSE, message=FALSE}

not_planted <- master_wide %>%
  filter(is.na(Notes_summer2019) | Notes_summer2019 == "not planted") %>%
  filter(is.na(Notes_fall2019) | Notes_fall2019 == "not planted") %>%
  filter(is.na(LiveDead_fall2019) | LiveDead_fall2019 == "not planted")

write_xlsx(not_planted, 'C:\\Users\\jattanasio\\Desktop\\R_related\\not_planted.xlsx')

master_wide <- master_wide %>%
  filter(is.na(Notes_summer2019) | Notes_summer2019 != "not planted") %>%
  filter(is.na(Notes_fall2019) | Notes_fall2019 != "not planted") %>%
  filter(is.na(LiveDead_fall2019) | LiveDead_fall2019 != "not planted")
# remember that the filter will delete the NAs, so manually kept them in
```

Fixing the seedlings with bad length data. There are 5 bad seedling lengths, 4 will have to be deleted
when I handle the lengths in the growth script and one will be edited here in the tidy script.

Realized I should add a column called Region where I specify if the plant is northern
or southern.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
master_wide <- master_wide %>%
  mutate(Region = case_when((Species == "ch.oak" | Species == "r.cedar" | Species == "tulip" |
           Species == "s.gum" | Species == "w.oak") ~ "south",
           Species == "r.oak" | Species == "w.spruce" | Species == "w.pine" ~ "north")
         , .before = Site)

```
```{r, echo=FALSE, warning=FALSE, message=FALSE}
master_wide$Length_summer2020[master_wide$Length_summer2020 == 44170.0] <- 12.5 
```

Re-exporting the master as an excel with the not planted deleted and the numeric fixed
```{r, echo=FALSE, warning=FALSE, message=FALSE}
write_xlsx(master_wide, 'C:\\Users\\jattanasio\\Desktop\\R_related\\master_wide.xlsx')
```

I wanted everything to have an assigned Unique value to keep track of edits

## Altered Data Points

|Unique ID  |Problem            |Action      |Location    |
|-----------|-------------------|------------|------------|
| 685       | not planted       | deleted    | tidy       |
| 697       | not planted       | deleted    | tidy       |
| 699       | not planted       | deleted    | tidy       |
| 708       | not planted       | deleted    | tidy       |
| 721       | not planted       | deleted    | tidy       |
| 723       | not planted       | deleted    | tidy       |
| 730       | not planted       | deleted    | tidy       |
| 743       | not planted       | deleted    | tidy       |
| 746       | not planted       | deleted    | tidy       |
| 760       | not planted       | deleted    | tidy       |
| 766       | not planted       | deleted    | tidy       |
| 1094      | not planted       | deleted    | tidy       |
| 1104      | not planted       | deleted    | tidy       |
| 1108      | not planted       | deleted    | tidy       |
| 1137      | not planted       | deleted    | tidy       |
| 1442      | not planted       | deleted    | tidy       |
| 1449      | not planted       | deleted    | tidy       |
| 1451      | not planted       | deleted    | tidy       |
| 346       | not planted       | deleted    | tidy       |
| 246       | "N" should be "D" | fixed      | LiveDead   |
| 1016      | "N" should be "L" | fixed      | LiveDead   |
| 1382      | bad length 2022   | fixed      | growth     |
| 808       | bad length 2022   | fixed      | growth     |
| 343       | bad length 2020   | fixed      | tidy       |
| 11        | bad length 2020   | fixed      | growth     |
| 1227      | bad length 2020   | fixed      | growth     |

Note: 200 seedlings had length measured in fall 2019 even when dead (fixed in growth)
Note: 182 bad tubes by summer 2024 (mostly fixed in tubes)


Tracking down suspicious plants!
```{r, echo=FALSE, warning=FALSE, message=FALSE}
# 1382 shrunk a lot in 2022?
sapling1382 <- master_wide %>%
  filter(UniqueID == 1382)
# in summer2022 it was recorded as 3148, and fall2022 was 43
# was recorded 29 summer2021 and dead fall2021
# I am leaning towards just deleting it as a record?
# SURRY PLOT 3 CELL E5 W. OAK
# Has a note that says "come back to this" in the not for field
# Was incorrectly entered in the field copy as well
# going to delete record

# 808 grew by over 400?
sapling808 <- master_wide %>%
  filter(UniqueID == 808)
# in summer2022 was 97, fall2022 was 549
# summer2023 was 180
# BELFAST PLOT 1 CELL E7 TULIP
# not positive this is an error I guess?

tulip_heights <- master_wide %>%
  filter(Species == "tulip") %>%
  select(starts_with("Length"), UniqueID)
# Tallest tulip anywhere is fall 2024 and 360
# Second tallest for the year this occurred (2022) is 132
# Seems suspicious. Can a plant really grow over 400 cm in a year... in just over 3 months
# going to delete record

# 343 suspicious
sapling343 <- master_wide %>%
  filter(UniqueID == 343)
# in fall2019 was 11 and summer2020 was 44170
# fall2020 was not collected
# summer2021 was 15
# MDI PLOT 4 CELL G7 W. PINE

# Found! Was entered as "12 5" and was reading as a date in R. Huzzah!

# 11 suspicious

sapling11 <- master_wide %>%
  filter(UniqueID == 11)
# length fall 2020
# MDI plot 1 cell B3 w.spruce
# Incorrect in the datasheet. I assume that it is supposed to be 31.5 not 315. Was 29 before
# Is this too much of a reach

sapling1227 <- master_wide %>%
  filter(UniqueID == 1227)
# length summer 2020 was 154
# length fall 2019 was 13 and fall 2020 was 12
# this is a w.spruce I think they measured the wrong tree
```

Trying to clean up 2019 length notes....

```{r, echo=FALSE, warning=FALSE, message=FALSE}
note19 <- master_wide %>%
  dplyr::select(ends_with("fall2019"), UniqueID)
```

How many of each spp is there actually in total and at each site
```{r, echo=FALSE, warning=FALSE, message=FALSE}
# How many species in total
species <- master_wide %>%
  group_by(Species) %>%
  summarize(n = n())
# How many species per site
species_site <- master_wide %>%
  group_by(Species, Site) %>%
  summarize(n = n())
# how many of each species had a tube?
species_tube <- master_wide %>%
  group_by(Species, Tube) %>%
  summarise(n = n())
# How many planted per site
site <- master_wide %>%
  group_by(Site) %>%
  summarize(n = n())
# How many per region planted
region <- master_wide %>%
  group_by(Region) %>%
  summarise(n = n())
```

## Number of Species Planted

|Species |Region  |Planted |
|--------|--------|--------|
|s.gum   |southern|193     |
|tulip   |southern|192     |
|r.cedar |southern|180     |
|ch.oak  |southern|192     |
|w.oak   |southern|186     |
|r.oak   |northern|192     |
|w.pine  |northern|191     |
|w.spruce|northern|192     |
|total   |southern|943     |
|total   |northern|575     |

## Number of Seedlings Planted Per Site

|Site    |Planted |
|--------|--------|
|Belfast |380     |  
|MDI     |383     |  
|Schoodic|374     |
|Surry   |381     |

Note: I used warm colors for southern species and cool colors for northern species
"#cb1201"
"#FC600A"
"#66B032"
"#603C14"
"#F3BC2E"
"#B25600"
"#347C98"
"#8601AF"
